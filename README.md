# Message Processing User-Bot

User-bot для автоматической обработки входящих сообщений в Telegram с возможностью настройки индивидуальных меток для каждого чата.

## Возможности

- Автоматическое извлечение данных из сообщений по заданным меткам
- Интеграция NLP для автоматического определения полей
- Проверка на дубликаты
- Гибкая настройка через интерфейс
- Многопоточная обработка сообщений
- Хранение данных в MongoDB
- Обработка ошибок и восстановление после сбоев
- Проверка дубликатов меток
- Сохранение состояния между перезапусками

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd message-processing-bot
```

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Установите модель spaCy для русского языка:
```bash
python -m spacy download ru_core_news_sm
```

4. Создайте файл `.env` со следующими переменными:
```
API_ID=your_telegram_api_id
API_HASH=your_telegram_api_hash
MONGODB_URI=your_mongodb_connection_string
```

## Получение API ID и API Hash

1. Перейдите на https://my.telegram.org
2. Войдите в свой аккаунт Telegram
3. Перейдите в раздел "API development tools"
4. Создайте новое приложение
5. Скопируйте API ID и API Hash в файл .env

## Использование

1. Запустите бота:
```bash
python bot.py
```

2. При первом запуске:
   - Введите номер телефона
   - Введите код подтверждения
   - При необходимости введите пароль двухфакторной аутентификации

3. В Telegram:
   - Отправьте команду `/config` для настройки параметров чата
   - Настройте метки для извлечения данных
   - Включите/выключите NLP обработку
   - Установите порог для определения дубликатов

## Настройка меток

Бот поддерживает следующие форматы меток:
- Предустановленные метки: "Дата:", "Адрес:", "Имя:", "Телефон:"
- Пользовательские метки в формате: "метка:поле"

Пример сообщения:
```
Дата: 2024-03-15
Адрес: ул. Ленина, 10
Имя: Иван Иванов
Телефон: +7 (999) 123-45-67
```

## NLP обработка

При включенной NLP обработке бот автоматически определяет:
- Даты
- Адреса
- Имена
- Номера телефонов

## База данных

Данные сохраняются в MongoDB с следующей структурой:
```json
{
    "chat_id": 123456789,
    "timestamp": "2024-03-15T12:00:00",
    "date": "2024-03-15",
    "address": "ул. Ленина, 10",
    "name": "Иван Иванов",
    "phone": "+7 (999) 123-45-67"
}
```

## Обработка ошибок

Бот включает в себя следующие механизмы обработки ошибок:
- Проверка подключения к MongoDB при запуске
- Обработка ошибок при обработке сообщений
- Восстановление после сетевых сбоев
- Логирование всех ошибок
- Корректное завершение работы при остановке

## Безопасность

1. Храните файл `.env` в безопасном месте
2. Не передавайте свой API ID и API Hash третьим лицам
3. Используйте двухфакторную аутентификацию в Telegram
4. Регулярно обновляйте зависимости
5. Используйте безопасное подключение к MongoDB
6. Ограничьте доступ к логам

## Мониторинг

Бот ведет подробное логирование:
- Ошибки подключения
- Ошибки обработки сообщений
- Успешные операции
- Изменения конфигурации
- Предупреждения о дубликатах

## Лицензия

MIT 